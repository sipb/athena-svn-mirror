%--------------------------------------------------------------------------
% This is small extension of T. Rokicki's EPSF.TEX (from DVIPS 5.58):
%  -- allows safe including of EPS files generated by DVIPS
%  -- can also display bounding boxes.
%--------------------------------------------------------------------------
% AUTHORS: Bogus\l{}aw Jackowski and Piotr Pianowski
%   BOP s.c.
%   ul. Piastowska 70, 80-363 Gda\'nsk, Poland
%   email: B.Jackowski@GUST.org.pl
% USAGE:
%   \eps{file.eps} % instead of \epsffile{file.eps}
% The following settings of the parameter \tracingeps are recognized:
%   \tracingeps=0  % default, no extra information displayed
%   \tracingeps=1  % displays bounding boxes and file names
%   \tracingeps>1  % displays graphics, bounding boxes and file names
% HISTORY:
% ver. 0.5  19 VIII 1994
% ver. 0.51 25 VIII 1994 
%      * \epsnamecolor added
% ver. 0.52 31 VIII 1994 
%      * \eps renamed to \epsraw
%      * \tps renamed to \eps
% ver. 0.53 9 I 1995
%      * `\isls false N' added to \eps 
%      * virtually active slash neutralized
% ver. 0.54 9 III 1995
%      * \eps clears bop-hook
% ver. 0.55 27 III 1995
%      * a patch neutralizing unnecessary rounding added
% ver. 0.56  3 X 1995
%      * \special commands surrounding EPS box are to be nested in the \vbox
% ver. 0.57  31 VIII 1996
%      * odd characters in names enabled
% ver. 0.58  21.III.1997
%      * setpageparams and setpage neutralized
% ver. 0.585 25.III.1997
%      * comments touched
% ver. 0.59 7 VI 1998
%      * EPSF.TEX included
% ver. 0.60 10 I 1999
%      * safe multiplication of eps dimensions by 10 (expected to be
%        included in the newest version of Rokicki's package)
%--------------------------------------------------------------------------
\edef\slashcatcode{\the\catcode`\/}
\catcode`\/12
%
%%%%%%%%%%%%%%%%%%%%%%%%%%% \input epsf  -- inserted below %%%%%%%%%%%%%%%%%
%   EPSF.TEX macro file:
%   Written by Tomas Rokicki of Radical Eye Software, 29 Mar 1989.
%   Revised by Don Knuth, 3 Jan 1990.
%   Revised by Tomas Rokicki to accept bounding boxes with no
%      space after the colon, 18 Jul 1990.
%
%   TeX macros to include an Encapsulated PostScript graphic.
%   Works by finding the bounding box comment,
%   calculating the correct scale values, and inserting a vbox
%   of the appropriate size at the current position in the TeX document.
%
%   To use with the center environment of LaTeX, preface the \epsffile
%   call with a \leavevmode.  (LaTeX should probably supply this itself
%   for the center environment.)
%
%   To use, simply say
%   \input epsf           % somewhere early on in your TeX file
%   \epsfbox{filename.ps} % where you want to insert a vbox for a figure
%
%   Alternatively, you can type
%
%   \epsfbox[0 0 30 50]{filename.ps} % to supply your own BB
%
%   which will not read in the file, and will instead use the bounding
%   box you specify.
%
%   The effect will be to typeset the figure as a TeX box, at the
%   point of your \epsfbox command. By default, the graphic will have its
%   `natural' width (namely the width of its bounding box, as described
%   in filename.ps). The TeX box will have depth zero.
%
%   You can enlarge or reduce the figure by saying
%     \epsfxsize=<dimen> \epsfbox{filename.ps}
%   (or
%     \epsfysize=<dimen> \epsfbox{filename.ps})
%   instead. Then the width of the TeX box will be \epsfxsize and its
%   height will be scaled proportionately (or the height will be
%   \epsfysize and its width will be scaled proportiontally).  The
%   width (and height) is restored to zero after each use.
%
%   A more general facility for sizing is available by defining the
%   \epsfsize macro.    Normally you can redefine this macro
%   to do almost anything.  The first parameter is the natural x size of
%   the PostScript graphic, the second parameter is the natural y size
%   of the PostScript graphic.  It must return the xsize to use, or 0 if
%   natural scaling is to be used.  Common uses include:
%
%      \epsfxsize  % just leave the old value alone
%      0pt         % use the natural sizes
%      #1          % use the natural sizes
%      \hsize      % scale to full width
%      0.5#1       % scale to 50% of natural size
%      \ifnum#1>\hsize\hsize\else#1\fi  % smaller of natural, hsize
%
%   If you want TeX to report the size of the figure (as a message
%   on your terminal when it processes each figure), say `\epsfverbosetrue'.
%
\newread\epsffilein    % file to \read
\newif\ifepsffileok    % continue looking for the bounding box?
\newif\ifepsfbbfound   % success?
\newif\ifepsfverbose   % report what you're making?
\newif\ifepsfdraft     % use draft mode?
\newdimen\epsfxsize    % horizontal size after scaling
\newdimen\epsfysize    % vertical size after scaling
\newdimen\epsftsize    % horizontal size before scaling
\newdimen\epsfrsize    % vertical size before scaling
\newdimen\epsftmp      % register for arithmetic manipulation
\newdimen\pspoints     % conversion factor
%
\pspoints=1bp          % Adobe points are `big'
\epsfxsize=0pt         % Default value, means `use natural size'
\epsfysize=0pt         % ditto
%
\def\epsfbox#1{\global\def\epsfllx{72}\global\def\epsflly{72}%
   \global\def\epsfurx{540}\global\def\epsfury{720}%
   \def\lbracket{[}\def\testit{#1}\ifx\testit\lbracket
   \let\next=\epsfgetlitbb\else\let\next=\epsfnormal\fi\next{#1}}%
%
\def\epsfgetlitbb#1#2 #3 #4 #5]#6{\epsfgrab #2 #3 #4 #5 .\\%
   \epsfsetgraph{#6}}%
%
\def\epsfnormal#1{\epsfgetbb{#1}\epsfsetgraph{#1}}%
%
\def\epsfgetbb#1{%
%
%   The first thing we need to do is to open the
%   PostScript file, if possible.
%
\openin\epsffilein=#1
\ifeof\epsffilein\errmessage{I couldn't open #1, will ignore it}\else
%
%   Okay, we got it. Now we'll scan lines until we find one that doesn't
%   start with %. We're looking for the bounding box comment.
%
   {\epsffileoktrue \chardef\other=12
    \def\do##1{\catcode`##1=\other}\dospecials \catcode`\ =10
    \loop
       \read\epsffilein to \epsffileline
       \ifeof\epsffilein\epsffileokfalse\else
%
%   We check to see if the first character is a % sign;
%   if not, we stop reading (unless the line was entirely blank);
%   if so, we look further and stop only if the line begins with
%   `%%BoundingBox:'.
%
          \expandafter\epsfaux\epsffileline:. \\%
       \fi
   \ifepsffileok\repeat
   \ifepsfbbfound\else
    \ifepsfverbose\message{No bounding box comment in #1; using defaults}\fi\fi
   }\closein\epsffilein\fi}%
%
%   Now we have to calculate the scale and offset values to use.
%   First we compute the natural sizes.
%
\def\epsfclipon{\def\epsfclipstring{ clip}}%
\def\epsfclipoff{\def\epsfclipstring{\ifepsfdraft\space clip\fi}}%
\epsfclipoff
%
\def\epsfsetgraph#1{%
   \epsfrsize=\epsfury\pspoints
   \advance\epsfrsize by-\epsflly\pspoints
   \epsftsize=\epsfurx\pspoints
   \advance\epsftsize by-\epsfllx\pspoints
%
%   If `epsfxsize' is 0, we default to the natural size of the picture.
%   Otherwise we scale the graph to be \epsfxsize wide.
%
   \epsfxsize\epsfsize\epsftsize\epsfrsize
   \ifnum\epsfxsize=0 \ifnum\epsfysize=0
      \epsfxsize=\epsftsize \epsfysize=\epsfrsize
      \epsfrsize=0pt
%
%   We have a sticky problem here:  TeX doesn't do floating point arithmetic!
%   Our goal is to compute y = rx/t. The following loop does this reasonably
%   fast, with an error of at most about 16 sp (about 1/4000 pt).
% 
     \else\epsftmp=\epsftsize \divide\epsftmp\epsfrsize
       \epsfxsize=\epsfysize \multiply\epsfxsize\epsftmp
       \multiply\epsftmp\epsfrsize \advance\epsftsize-\epsftmp
       \epsftmp=\epsfysize
       \loop \advance\epsftsize\epsftsize \divide\epsftmp 2
       \ifnum\epsftmp>0
          \ifnum\epsftsize<\epsfrsize\else
             \advance\epsftsize-\epsfrsize \advance\epsfxsize\epsftmp \fi
       \repeat
       \epsfrsize=0pt
     \fi
   \else \ifnum\epsfysize=0
     \epsftmp=\epsfrsize \divide\epsftmp\epsftsize
     \epsfysize=\epsfxsize \multiply\epsfysize\epsftmp   
     \multiply\epsftmp\epsftsize \advance\epsfrsize-\epsftmp
     \epsftmp=\epsfxsize
     \loop \advance\epsfrsize\epsfrsize \divide\epsftmp 2
     \ifnum\epsftmp>0
        \ifnum\epsfrsize<\epsftsize\else
           \advance\epsfrsize-\epsftsize \advance\epsfysize\epsftmp \fi
     \repeat
     \epsfrsize=0pt
    \else
     \epsfrsize=\epsfysize
    \fi
   \fi
%
%  Finally, we make the vbox and stick in a \special that dvips can parse.
%
   \ifepsfverbose\message{#1: width=\the\epsfxsize, height=\the\epsfysize}\fi
   \epsftmp=10\epsfxsize \divide\epsftmp\pspoints
   \vbox to\epsfysize{\vfil\hbox to\epsfxsize{%
      \ifnum\epsfrsize=0\relax
        \special{PSfile=\ifepsfdraft psdraft.ps\else#1\fi\space
             llx=\epsfllx\space lly=\epsflly\space
             urx=\epsfurx\space ury=\epsfury\space rwi=\number\epsftmp
             \epsfclipstring}%
      \else
        \epsfrsize=10\epsfysize \divide\epsfrsize\pspoints
        \special{PSfile=\ifepsfdraft psdraft.ps\else#1\fi\space
             llx=\epsfllx\space lly=\epsflly\space
             urx=\epsfurx\space ury=\epsfury\space rwi=\number\epsftmp\space
             rhi=\number\epsfrsize \epsfclipstring}%
      \fi
      \hfil}}%
\global\epsfxsize=0pt\global\epsfysize=0pt}%
%
%   We still need to define the tricky \epsfaux macro. This requires
%   a couple of magic constants for comparison purposes.
%
{\catcode`\%=12 \global\let\epsfpercent=%\global\def\epsfbblit{%BoundingBox}}%
%
%   So we're ready to check for `%BoundingBox:' and to grab the
%   values if they are found.
%
\long\def\epsfaux#1#2:#3\\{\ifx#1\epsfpercent
   \def\testit{#2}\ifx\testit\epsfbblit
      \epsfgrab #3 . . . \\%
      \epsffileokfalse
      \global\epsfbbfoundtrue
   \fi\else\ifx#1\par\else\epsffileokfalse\fi\fi}%
%
%   Here we grab the values and stuff them in the appropriate definitions.
%
\def\epsfempty{}%
\def\epsfgrab #1 #2 #3 #4 #5\\{%
\global\def\epsfllx{#1}\ifx\epsfllx\epsfempty
      \epsfgrab #2 #3 #4 #5 .\\\else
   \global\def\epsflly{#2}%
   \global\def\epsfurx{#3}\global\def\epsfury{#4}\fi}%
%
%   We default the epsfsize macro.
%
\def\epsfsize#1#2{\epsfxsize}
%
%   Finally, another definition for compatibility with older macros.
%
\let\epsffile=\epsfbox
%%%%%%%%%%%%%%%%%%%%%%%%%%%%% End of EPSF %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ---
\newcount\tracingeps \tracingeps0
% ---
\newbox\tmpepsbox
% ---
\ifx\epsdirundefined\epsdir\def\epsdir{}\fi
\def\epsnamecolor{1 0 0}
% ---
% BOTH \eps and \epsraw ``normalize'' the eps name, as one may wish
% to use \epsraw separately
% ---
\def\epsraw{\begingroup\escapechar-1\catcode`\%12\def荏趄轭琬苠痼蜥縻镱酏茕彐苠痼蜥縻镱簦丙茗溴孳翳邋痼钺礤苠疳钿徭翦蜍篝蜷铉茔箢犴澹避孱溷箢犴妪苠钿珧秕荛骖蹴荇蜥汩铉屦蠼荑怙苠痼骀殪妍苠痼溟蜍翳邋痼钺礤苕荛骖蹴荇蜥汩铉屦缶荑怙荏弭怙荇眇屦筲秫荑怙苠痼骀殪妍苠痼溟蜍翳邋痼钺礤荛骖蹴荇蜥汩铉屦缶茯灬瘥茔镳荇眇屦筲秫苕荟怙茱骀轭翦蜢轭弩腴荑蝓戾荟箅轲答荑怙麸荀滠繇疱痼怙荟蝓戾荑篌荟怙麸荑糗繇疱痼怙荟篌荑怙荇荏疱汩犰痼虹筢鲥苠痼钺礤泔祜蜍箴徙箦趄玮泔祜螨荇桢屦箢犴遘箴邈獒禧痼虹蝈篝矧妪荟篌荑篌荟蝓戾荟箅轲答糗栩蹯苕辇茕彐苠痼茆彗轭珧秕苠筱狃邈栳颦茔狒泔溴嘬ケ茕彐荏趄轭琬苠痼泔铘茕彐苠痼泔铘１茗溴孳翳邋痼钺礤苠疳钿徭翦蜍篝蜷铉茔箢犴澹避孱溷箢犴妪苠钿珧秕荟怙荏疱汩犰痼由麴筢鲥轶祗驷祗篝狒躞溟泗忮玳箦麴徵屦狎犴痫痫痫痫瘕溴箦麴徵痫痫痫瘕溴孱躞弪溟泗忮玳怙瓠栾镫溴孱苠痼蜥鬈翳邋痼钺礤荏疱汩犰痼由麴蝈篝矧义溴骈铋糸镱镦屦箧磲泸矬澡鲠祯弩镦囹鏖犷囹栝疳蜥礤翦蝮狎麸忮玳鲥轭翦铘梵镦忾痫轭艋翳镬溴鲥蝮轱镦翳屦箧疳汶徵躞邃麸眭祠轲禊溟礤蝈玳篝弪怡卑麒殂瘐箦鲥蝈扉黹翎糸镱镱翳狯衢灬忪判箝瀹澡磲泸嘬溴汩磲祗栝骠眭祠轲扉弩玳鲥鲠祯怡卑噜簌铘徙糸汜祆Ё楫瀹徙泔眇扉箬弩噜溴汩磲箬殒糸铉Ё翳骘祆秣轭泔钿轸轱铙狎狍篚礤麸栾熹戾徜轭弪矬狎礤犷轭珈弩蠡间殓轸精拣弪轱渚间轫孱躅轸轶痱镳弪骘蝽镦溟礤鲠祯寤翳泔眄犷嘬翳濮狃痨殄麸溟礤蝈玳篝弪殄熹汜铒铋汜骘蝽奂黹铛缶菁溟玳艟奂疱蜷镤炯溟玳艟菁痿躅轸麒弪拣躅轸狎囵犷圄汨狎徙翦蝮栳鲩铉汜翦顼蝙泔溴辈茕彐茕邈轫犰箬殒簦丙１溟礤蝈玳篝弪苠疳钿徭翦蜍屮疳钿徭翦蜍屮疳钿徭翦茕邈轫犰箴扉糗屮疳钿徭翦蜍顼忖戾性荇桢１茯屐狲茕彐茕邈轫犰箴扉簦碑２茯屐狲荛骖蹴１桨荛驿轫１斌鸾斌苕苠祗１苕荛驿轫埃搀鸾绑败屐箦苕蜥泗轱铙栝骠２苕茕彐苕蜥泗轱铙栝骠１２荛骖蹴埃步１苠祗１２苕辇茔狒泔溴嘬鸨茔狒泔溴嘬舯茜溴孳顼忖戾性１痿１茕彐莛趑镡瘥爱构恫洞氨凡凡卜茕彐苠痼骟弭珧狃瑁丙苠痼骝箝褰苠痼骢蝙莛箴镩铘茚漩犷沐苠痼骝箝怡苠痼骒禊莛箴镩铘苠痼骠箝褰苠痼骢蝤莛箴镩铘茚漩犷沐苠痼骠箝怡苠痼骒禅莛箴镩铘涉噱痼骧箝濮轶艾麇溴驷蹯麸翳钺趱蜥箝镦翳痖泗躜瀹萧桢蝼轶麇筱犰翳珧狃麸忮苠痼骧箝鏖溴苠痼骧箝遘屦箧箝遘屦箧趔辁遘屦箧蝮辁荛骖蹴苠痼骧箝褰荛骖蹴苠痼纟箝褰苠痼骧箝褰苠痼骠箝苠痼纟箝褰苠痼骝箝苠痼骝箝褰梆族栳鲥篝殂膣痱镡戾桢蝈藻滹弩瞌滹骒镝糸铉痫轭狎轸桧弭殂硝顼犰轶麸泔眇豸蝤舢澡骘祆秣轭祜镳滹弩翳轶蝈狍镱徕禊驷篝鏖翳犷弪蝻镦狒盹篝徕秕倍箴ㄡ怙豸悲窗鞍痿┊苠祗遘屦箧繇鸾苠痼骠箝茕轹殇遘屦箧繇疖屦箧蝮辁苠痼骧箝褰苠痼纟箝茼蹯糸痨苠痼骧箝遘屦箧繇茼蹯糸痨苠痼骠眇苠痼骝箝茚漩犷沐苠痼骠箝瀛苠痼骠眇苠痼骠眇杰屦箧箝莒镲茚漩犷沐苠痼骠箝遘屦箧趔辁茕轹殇遘屦箧繇荛骖蹴苠痼骠眇景荛骖蹴苠痼骠箝寮苠痼骝箝遘屐箦茚漩犷沐苠痼骠箝瀛苠痼骝箝茚漩犷沐苠痼骧箝遘屦箧繇苕茯屦遽苠痼骝箝褰梆苕苠祗荛骖蹴苠痼纟箝褰苠痼骠眇杰屦箧蝮辁茕轹殇遘屦箧繇疖屦箧趔辁苠痼纟箝褰苠痼骧箝茼蹯糸痨苠痼纟箝遘屦箧繇茼蹯糸痨苠痼骠眇苠痼骠箝茚漩犷沐苠痼骝箝瀛苠痼骠眇苠痼骠眇杰屦箧箝莒镲茚漩犷沐苠痼骝箝遘屦箧蝮辁茕轹殇遘屦箧繇荛骖蹴苠痼骠眇景荛骖蹴苠痼骝箝寮苠痼骠箝遘屐箦茚漩犷沐苠痼骝箝瀛苠痼骠箝茚漩犷沐苠痼纟箝遘屦箧繇苕茯屦遽苠痼骝箝褰梆苠祗苠痼骝箝褰苠痼纟箝苕苕崎钺祆麇磲脲翳鲡秫犷篝殂轭荏疱汩犰翳狒漩轲汜疳蝮瀹荛驽痼骣弪怙箦茼弩筢珏１鏖漪杞荇桢苠痼骧箝瀣桢殓梏杰翳遘屦箧箝妪苕苠痼骠眇杰痿麸怵苠痼骧箝荟怙麸苠痼纟箝妍荟骈燔桠秫麸苠痼骧箝妍荛骖蹴苠痼骝箝褰败蝈灬荏疱汩犰杏骈戾杰殒屦箧潋徭痼潋徭舢痼苠祗澹避骈荏疳沐祆杰屦箧祆荏疳沐祆杰屦箧祆荏疳沐躜杰屦箧躜荏疳沐躜杰屦箧躜荏疳沐蝼榻茕邈轫犰箬殒糗屦箧繇苠痼驺扉痼趄轭琮苠祗苠痼骝箝褰莛趑镡疖屦箧箝荏疱汩犰杏骈戾杰殒屦箧潋徭痼潋徭舢痼苠祗澹避骈荏疳沐祆杰屦箧祆荏疳沐祆杰屦箧祆荏疳沐躜杰屦箧躜荏疳沐躜杰屦箧躜荏疳沐蝼榻茕邈轫犰箬殒糗屦箧繇疖箴徙蜩榻茕邈轫犰箬殒糗屦箧蝮辁苠痼驺扉痼趄轭琮苕荑骈忑茜祜忉燔屦箧箝褰梆糗珈镡犰苠痼纟箝褰梆酏茔狒泔溴嘬荏灬箬汜翥镤苠钿轭瘐
<refentry id="libgnomeprint-Pango-Integration">
<refmeta>
<refentrytitle>Pango Integration</refentrytitle>
<manvolnum>3</manvolnum>
<refmiscinfo>LIBGNOMEPRINT Library</refmiscinfo>
</refmeta>

<refnamediv>
<refname>Pango Integration</refname><refpurpose>Using gnome-print with Pango</refpurpose>
</refnamediv>

<refsynopsisdiv><title>Synopsis</title>

<synopsis>



<link linkend="PangoFontMap">PangoFontMap</link>* <link linkend="gnome-print-pango-font-map-new">gnome_print_pango_font_map_new</link>
                                            (void);
<link linkend="PangoFontMap">PangoFontMap</link>* <link linkend="gnome-print-pango-get-default-font-map">gnome_print_pango_get_default_font_map</link>
                                            (void);
<link linkend="PangoContext">PangoContext</link>* <link linkend="gnome-print-pango-create-context">gnome_print_pango_create_context</link>
                                            (<link linkend="PangoFontMap">PangoFontMap</link> *fontmap);
<link linkend="void">void</link>        <link linkend="gnome-print-pango-update-context">gnome_print_pango_update_context</link>
                                            (<link linkend="PangoContext">PangoContext</link> *context,
                                             <link linkend="GnomePrintContext">GnomePrintContext</link> *gpc);
<link linkend="PangoLayout">PangoLayout</link>* <link linkend="gnome-print-pango-create-layout">gnome_print_pango_create_layout</link>
                                            (<link linkend="GnomePrintContext">GnomePrintContext</link> *gpc);
<link linkend="void">void</link>        <link linkend="gnome-print-pango-glyph-string">gnome_print_pango_glyph_string</link>  (<link linkend="GnomePrintContext">GnomePrintContext</link> *gpc,
                                             <link linkend="PangoFont">PangoFont</link> *font,
                                             <link linkend="PangoGlyphString">PangoGlyphString</link> *glyphs);
<link linkend="void">void</link>        <link linkend="gnome-print-pango-layout-line">gnome_print_pango_layout_line</link>   (<link linkend="GnomePrintContext">GnomePrintContext</link> *gpc,
                                             <link linkend="PangoLayoutLine">PangoLayoutLine</link> *line);
<link linkend="void">void</link>        <link linkend="gnome-print-pango-layout">gnome_print_pango_layout</link>        (<link linkend="GnomePrintContext">GnomePrintContext</link> *gpc,
                                             <link linkend="PangoLayout">PangoLayout</link> *layout);
<link linkend="void">void</link>        <link linkend="gnome-print-pango-layout-print">gnome_print_pango_layout_print</link>  (<link linkend="GnomePrintContext">GnomePrintContext</link> *gpc,
                                             <link linkend="PangoLayout">PangoLayout</link> *pl);
</synopsis>
</refsynopsisdiv>









<refsect1>
<title>Description</title>
<para>
The functions in this section allow you to use gnome-print to
draw text using the sophisticated layout and internationalization
capabilities of the Pango library. In general, for a GNOME
application, these are the text APIs you should be using.
</para>
<para>
There are a number of different types of objects involved in
using <link linkend="Pango"><type>Pango</type></link> with gnome-print.
</para>
<variablelist>
  <varlistentry>
    <term><link linkend="PangoFontMap">PangoFontMap</link></term>
    <listitem>
      <para>
        A <link linkend="PangoFontMap">PangoFontMap</link> contains
        the information necessary to resolve abstract font names
        to particular fonts on the system. A font map appropriate
        for use with gnome-print is created using
<link
linkend="gnome-print-pango-font-map-new"><function><link linkend="gnome-print-pango-font-map-new"><function>gnome_print_pango_font_map_new()</function></link></function></link>.
        Normally instead of creating a new font map, you can just
        use the global default font map returned by
<link
linkend="gnome-print-pango-get-default-font-map"><function><link linkend="gnome-print-pango-get-default-font-map"><function>gnome_print_pango_get_default_font_map()</function></link></function></link>.
        The only exception to this is if you need to use lower level
        Pango APIs to customize how the font name to font lookup is
        done, since modifying the global default font map isn't allowed.
      </para>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><link linkend="PangoContext">PangoContext</link></term>
    <listitem>
      <para>
        Information about doing layout for a particular output device
        with a particular set of options is
        encapsulated into a <link
        linkend="PangoContext">PangoContext</link>. Contexts for
        gnome-print are created using
        <link
linkend="gnome-print-pango-create-context"><function><link linkend="gnome-print-pango-create-context"><function>gnome_print_pango_create_context()</function></link></function></link>
      </para>
      <para>
        A Pango context created in this way is not specific to a
        particular <link
        linkend="GnomePrintContext">GnomePrintContext</link> but
        before using a Pango context to do layout for a gnome-print
        context, it's necessary to call
        <link
linkend="gnome-print-pango-update-context"><function><link linkend="gnome-print-pango-update-context"><function>gnome_print_pango_update_context()</function></link></function></link>.
        This function also needs to be called if when the current
        transformation matrix changes.
      </para>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><link linkend="PangoLayout">PangoLayout</link></term>
    <listitem>
      <para>
        A <link linkend="PangoLayout">PangoLayout</link> holds one or more paragraphs of text
        and encapsulates all the necessary logic needed to
        line wrap and lay out the text. Once you have a 
        <link linkend="PangoContext"><type>PangoContext</type></link>, you can create a layout using
        <link linkend="pango_layout_new"><function><link linkend="pango-layout-new"><function>pango_layout_new()</function></link></function></link>.
      </para>
    </listitem>
  </varlistentry>
</variablelist>
<para>
In the normal case, a <link linkend="PangoFontMap">PangoFontMap</link>
created directly with <link
linkend="gnome-print-pango-create-layout"><function><link linkend="gnome-print-pango-create-layout"><function>gnome_print_pango_create_layout()</function></link></function></link>
is all that is needed. A simple example that uses Pango to draw a string centered
in a page looks like:
</para>

<informalexample><programlisting>
static void
draw_hello_world (GnomePrintContext *gpc,
                  double             page_width,
                  double             page_height)
{
  PangoLayout *layout = gnome_print_pango_create_layout (gpc);
  int pango_width, pango_height;
  double width, height;

  pango_layout_set_text (layout, "Hello World");

  pango_layout_get_size (layout, &amp;pango_width, &amp;pango_height);
  width = (double) pango_width / PANGO_SCALE;
  height = (double) pango_height / PANGO_SCALE;

  gnome_print_moveto (gpc,
	             (page_width - width) / 2,
                     (page_width - height)/ 2);
  gnome_print_pango_layout (gpc, layout);

  g_object_unref (layout);
}
</programlisting></informalexample>

<para>
Note the need to convert from Pango units to the floating point
units that gnome-print uses by dividing by
<link linkend="PANGO-SCALE-CAPS"><literal>PANGO_SCALE</literal></link>.
</para>
</refsect1>

<refsect1>
<title>Details</title>
<refsect2>
<title><anchor id="gnome-print-pango-font-map-new"/>gnome_print_pango_font_map_new ()</title>
<indexterm><primary>gnome_print_pango_font_map_new</primary></indexterm><programlisting><link linkend="PangoFontMap">PangoFontMap</link>* gnome_print_pango_font_map_new
                                            (void);</programlisting>
<para>
Creates a new <link linkend="PangoFontMap"><type>PangoFontMap</type></link> object suitable for use with
gnome-print. In most cases, you probably want to use
<link linkend="gnome-print-pango-get-default-font-map"><function>gnome_print_pango_get_default_font_map()</function></link> instead.</para>
<para>

</para><variablelist role="params">
<varlistentry><term><emphasis>Returns</emphasis>&nbsp;:</term><listitem><simpara> a newly created <link linkend="PangoFontMap"><type>PangoFontMap</type></link> object
</simpara></listitem></varlistentry>
</variablelist></refsect2>
<refsect2>
<title><anchor id="gnome-print-pango-get-default-font-map"/>gnome_print_pango_get_default_font_map ()</title>
<indexterm><primary>gnome_print_pango_get_default_font_map</primary></indexterm><programlisting><link linkend="PangoFontMap">PangoFontMap</link>* gnome_print_pango_get_default_font_map
                                            (void);</programlisting>
<para>
Gets a singleton <link linkend="PangoFontMap"><type>PangoFontMap</type></link> object suitable for
use with gnome-print.</para>
<para>

</para><variablelist role="params">
<varlistentry><term><emphasis>Returns</emphasis>&nbsp;:</term><listitem><simpara> the default <link linkend="PangoFontMap"><type>PangoFontMap</type></link> object for gnome-print. The
returned object is owned by gnome-print and should not be modified.
(If you need to set custom options, create a new font map with
<link linkend="gnome-print-pango-font-map-new"><function>gnome_print_pango_font_map_new()</function></link>.)  The reference count is
<emphasis>not</emphasis> increased.
</simpara></listitem></varlistentry>
</variablelist></refsect2>
<refsect2>
<title><anchor id="gnome-print-pango-create-context"/>gnome_print_pango_create_context ()</title>
<indexterm><primary>gnome_print_pango_create_context</primary></indexterm><programlisting><link linkend="PangoContext">PangoContext</link>* gnome_print_pango_create_context
                                            (<link linkend="PangoFontMap">PangoFontMap</link> *fontmap);</programlisting>
<para>
Creates a new <link linkend="PangoContext"><type>PangoContext</type></link> object for the specified fontmap.</para>
<para>

</para><variablelist role="params">
<varlistentry><term><parameter>fontmap</parameter>&nbsp;:</term>
<listitem><simpara> a <link linkend="PangoFontMap"><type>PangoFontMap</type></link> from <link linkend="gnome-print-pango-get-default-font-map"><function>gnome_print_pango_get_default_font_map()</function></link>
 or <link linkend="gnome-print-pango-create-font-map"><function>gnome_print_pango_create_font_map()</function></link>.
</simpara></listitem></varlistentry>
<varlistentry><term><emphasis>Returns</emphasis>&nbsp;:</term><listitem><simpara> a newly created <link linkend="PangoContext"><type>PangoContext</type></link> object
</simpara></listitem></varlistentry>
</variablelist></refsect2>
<refsect2>
<title><anchor id="gnome-print-pango-update-context"/>gnome_print_pango_update_context ()</title>
<indexterm><primary>gnome_print_pango_update_context</primary></indexterm><programlisting><link linkend="void">void</link>        gnome_print_pango_update_context
                                            (<link linkend="PangoContext">PangoContext</link> *context,
                                             <link linkend="GnomePrintContext">GnomePrintContext</link> *gpc);</programlisting>
<para>
Update a context so that layout done with it reflects the
current state of <parameter>gpc</parameter>. In general, every time you use a
<link linkend="PangoContext"><type>PangoContext</type></link> with a different <link linkend="GnomePrintContext"><type>GnomePrintContext</type></link>, or
you change the transformation matrix of the <link linkend="GnomePrintContext"><type>GnomePrintContext</type></link>
(other than pure translations) you should call this function.
You also need to call <link linkend="pango-layout-context-changed"><function>pango_layout_context_changed()</function></link> for any
<link linkend="PangoLayout"><type>PangoLayout</type></link> objects that exit for the <link linkend="PangoContext"><type>PangoContext</type></link>.
</para>
<para>
This function currently does nothing and that isn't expected
to change for gnome-print. The main benefit of calling it
is that your code will be properly prepared for conversion
to use with future rendering systems such as Cairo where
the corresponding operation will actually do something.</para>
<para>

</para><variablelist role="params">
<varlistentry><term><parameter>context</parameter>&nbsp;:</term>
<listitem><simpara> a <link linkend="PangoContext"><type>PangoContext</type></link> from <link linkend="gnome-print-pango-create-context"><function>gnome_print_pango_create_context()</function></link>.
</simpara></listitem></varlistentry>
<varlistentry><term><parameter>gpc</parameter>&nbsp;:</term>
<listitem><simpara> a <link linkend="GnomePrintContext"><type>GnomePrintContext</type></link>
</simpara></listitem></varlistentry>
</variablelist></refsect2>
<refsect2>
<title><anchor id="gnome-print-pango-create-layout"/>gnome_print_pango_create_layout ()</title>
<indexterm><primary>gnome_print_pango_create_layout</primary></indexterm><programlisting><link linkend="PangoLayout">PangoLayout</link>* gnome_print_pango_create_layout
                                            (<link linkend="GnomePrintContext">GnomePrintContext</link> *gpc);</programlisting>
<para>
Convenience function that creates a new <link linkend="PangoContext"><type>PangoContext</type></link>, updates
it for rendering to <parameter>gpc</parameter>, and then creates a <link linkend="PangoLayout"><type>PangoLayout</type></link> for
that <link linkend="PangoContext"><type>PangoContext</type></link>. Generally this function suffices for
most usage of gnome-print with Pango and you don't need to
deal with the <link linkend="PangoContext"><type>PangoContext</type></link> directly.</para>
<para>

</para><variablelist role="params">
<varlistentry><term><parameter>gpc</parameter>&nbsp;:</term>
<listitem><simpara> a <link linkend="GnomePrintContext"><type>GnomePrintContext</type></link>
</simpara></listitem></varlistentry>
<varlistentry><term><emphasis>Returns</emphasis>&nbsp;:</term><listitem><simpara> the newly created <link linkend="PangoLayout"><type>PangoLayout</type></link>. Free with
 <link linkend="g-object-unref"><function>g_object_unref()</function></link> when you are done with it.
</simpara></listitem></varlistentry>
</variablelist></refsect2>
<refsect2>
<title><anchor id="gnome-print-pango-glyph-string"/>gnome_print_pango_glyph_string ()</title>
<indexterm><primary>gnome_print_pango_glyph_string</primary></indexterm><programlisting><link linkend="void">void</link>        gnome_print_pango_glyph_string  (<link linkend="GnomePrintContext">GnomePrintContext</link> *gpc,
                                             <link linkend="PangoFont">PangoFont</link> *font,
                                             <link linkend="PangoGlyphString">PangoGlyphString</link> *glyphs);</programlisting>
<para>
Draws the glyphs in <parameter>glyphs</parameter> into the specified <link linkend="GnomePrintContext"><type>GnomePrintContext</type></link>.
Positioning information in <parameter>glyphs</parameter> is transformed by the current
transformation matrix, the glyphs are drawn in the current color,
and the glyphs are positioned so that the left edge of the baseline
is at the current point.</para>
<para>

</para><variablelist role="params">
<varlistentry><term><parameter>gpc</parameter>&nbsp;:</term>
<listitem><simpara> a <link linkend="GnomePrintContext"><type>GnomePrintContext</type></link>
</simpara></listitem></varlistentry>
<varlistentry><term><parameter>font</parameter>&nbsp;:</term>
<listitem><simpara> the <link linkend="PangoFont"><type>PangoFont</type></link> that the glyphs in <parameter>glyphs</parameter> are from
</simpara></listitem></varlistentry>
<varlistentry><term><parameter>glyphs</parameter>&nbsp;:</term>
<listitem><simpara> a <link linkend="PangoGlyphString"><type>PangoGlyphString</type></link>
</simpara></listitem></varlistentry>
</variablelist></refsect2>
<refsect2>
<title><anchor id="gnome-print-pango-layout-line"/>gnome_print_pango_layout_line ()</title>
<indexterm><primary>gnome_print_pango_layout_line</primary></indexterm><programlisting><link linkend="void">void</link>        gnome_print_pango_layout_line   (<link linkend="GnomePrintContext">GnomePrintContext</link> *gpc,
                                             <link linkend="PangoLayoutLine">PangoLayoutLine</link> *line);</programlisting>
<para>
Draws the text in <parameter>line</parameter> into the specified <link linkend="GnomePrintContext"><type>GnomePrintContext</type></link>.  The
text is drawn in the current color unless that has been overridden
by attributes set on the layout and the glyphs are positioned so
that the left edge of the baseline is at the current point.</para>
<para>

</para><variablelist role="params">
<varlistentry><term><parameter>gpc</parameter>&nbsp;:</term>
<listitem><simpara> a <link linkend="GnomePrintContext"><type>GnomePrintContext</type></link>
</simpara></listitem></varlistentry>
<varlistentry><term><parameter>line</parameter>&nbsp;:</term>
<listitem><simpara> a <link linkend="PangoLayoutLine"><type>PangoLayoutLine</type></link>
</simpara></listitem></varlistentry>
</variablelist></refsect2>
<refsect2>
<title><anchor id="gnome-print-pango-layout"/>gnome_print_pango_layout ()</title>
<indexterm><primary>gnome_print_pango_layout</primary></indexterm><programlisting><link linkend="void">void</link>        gnome_print_pango_layout        (<link linkend="GnomePrintContext">GnomePrintContext</link> *gpc,
                                             <link linkend="PangoLayout">PangoLayout</link> *layout);</programlisting>
<para>
Draws the text in <parameter>layout</parameter> into the specified <link linkend="GnomePrintContext"><type>GnomePrintContext</type></link>.  The
text is drawn in the current color unless that has been overridden
by attributes set on the layout and the glyphs are positioned so
that the left edge of the baseline is at the current point.</para>
<para>

</para><variablelist role="params">
<varlistentry><term><parameter>gpc</parameter>&nbsp;:</term>
<listitem><simpara> a <link linkend="GnomePrintContext"><type>GnomePrintContext</type></link>
</simpara></listitem></varlistentry>
<varlistentry><term><parameter>layout</parameter>&nbsp;:</term>
<listitem><simpara> a <link linkend="PangoLayout"><type>PangoLayout</type></link>
</simpara></listitem></varlistentry>
</variablelist></refsect2>
<refsect2>
<title><anchor id="gnome-print-pango-layout-print"/>gnome_print_pango_layout_print ()</title>
<indexterm><primary>gnome_print_pango_layout_print</primary></indexterm><programlisting><link linkend="void">void</link>        gnome_print_pango_layout_print  (<link linkend="GnomePrintContext">GnomePrintContext</link> *gpc,
                                             <link linkend="PangoLayout">PangoLayout</link> *pl);</programlisting>
<para>
Draws the text in <parameter>pl</parameter> into the specified <link linkend="GnomePrintContext"><type>GnomePrintContext</type></link>.  The
text is drawn in the current color unless that has been overridden
by attributes set on the layout and the glyphs are positioned so
that the left edge of the baseline is at the point (0, 0). This function
is obsolete; use <link linkend="gnome-print-pango-layout"><function>gnome_print_pango_layout()</function></link> instead.</para>
<para>

</para><variablelist role="params">
<varlistentry><term><parameter>gpc</parameter>&nbsp;:</term>
<listitem><simpara> a <link linkend="GnomePrintContext"><type>GnomePrintContext</type></link>
</simpara></listitem></varlistentry>
<varlistentry><term><parameter>pl</parameter>&nbsp;:</term>
<listitem><simpara> the <link linkend="PangoLayout"><type>PangoLayout</type></link> to print
</simpara></listitem></varlistentry>
</variablelist></refsect2>

</refsect1>




</refentry>

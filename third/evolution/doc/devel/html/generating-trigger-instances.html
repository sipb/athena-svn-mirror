<HTML
><HEAD
><TITLE
>Generating trigger instances</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.77"><LINK
REL="HOME"
TITLE="Evolution Developer's Guide"
HREF="index.html"><LINK
REL="UP"
TITLE="How the Wombat generates alarm instances"
HREF="calendar-alarm-generation.html"><LINK
REL="PREVIOUS"
TITLE="How the Wombat generates alarm instances"
HREF="calendar-alarm-generation.html"><LINK
REL="NEXT"
TITLE="Alarm trigger generation code"
HREF="alarm-trigger-generation-code.html"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
BGCOLOR="#000000"
CELLPADDING="1"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
><FONT
COLOR="#FFFFFF"
SIZE="5"
><SPAN
CLASS="APPLICATION"
>Evolution</SPAN
> Developer's Guide</FONT
></TH
></TR
><TR
><TD
WIDTH="25%"
BGCOLOR="#C00000"
ALIGN="left"
><A
HREF="calendar-alarm-generation.html"
><FONT
COLOR="#FFFFFF"
SIZE="3"
><B
>&#60;&#60;&#60; Previous Page</B
></FONT
></A
></TD
><TD
WIDTH="25%"
BGCOLOR="#0000C0"
ALIGN="center"
><FONT
COLOR="#FFFFFF"
SIZE="3"
><B
><A
HREF="index.html"
><FONT
COLOR="#FFFFFF"
SIZE="3"
><B
>Home</B
></FONT
></A
></B
></FONT
></TD
><TD
WIDTH="25%"
BGCOLOR="#00C000"
ALIGN="center"
><FONT
COLOR="#FFFFFF"
SIZE="3"
><B
><A
HREF="calendar-alarm-generation.html"
><FONT
COLOR="#FFFFFF"
SIZE="3"
><B
>Up</B
></FONT
></A
></B
></FONT
></TD
><TD
WIDTH="25%"
BGCOLOR="#C00000"
ALIGN="right"
><A
HREF="alarm-trigger-generation-code.html"
><FONT
COLOR="#FFFFFF"
SIZE="3"
><B
>Next Page &#62;&#62;&#62;</B
></FONT
></A
></TD
></TR
></TABLE
></DIV
><BR
CLEAR="all"><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GENERATING-TRIGGER-INSTANCES"
></A
>Generating trigger instances</H1
><P
>	Generating absolute triggers is trivial; you just use the date
	and time they specify.  However, relative triggers are
	associated to recurrence instances, so in order to generate
	trigger instances we must generate the corresponding
	recurrence instances and compute the trigger times based on
	those.
      </P
><P
>	Since relative triggers are specified as occurring a certain
	amount of time before or after each of a calendar component's
	recurrence instances, we can compute a trigger time by adding
	or subtracting that amount of time to the corresponding
	recurrence instance's time.
      </P
><P
>	Recurrence instances are generated by specifying a range of
	time and asking the Wombat to generate the instances that
	occur within that range.  We shall see that the range of time
	in which instances occur is not necessarily the same range of
	time in which those instances' alarm triggers occur.
      </P
><P
>	Consider an alarm that is set to trigger 10 minutes before the
	start time of an event's occurrence, that is, the trigger has
	an offset of -10 minutes.  Say this event recurs every hour at
	5 minutes past the hour:  it would occur at 1:05, 2:05, 3:05,
	etc.; the corresponding triggers would occur at 12:55, 1:55,
	2:55, etc.  If we wish to compute the alarm triggers that
	occur between 4:00 and 6:00 (which would be at 4:55 and 5:55),
	then we cannot just generate recurrence instances between 4:00
	and 6:00 because we will miss the 6:05 occurrence which
	corresponds to the 5:55 trigger.
      </P
><P
>	The solution is to expand the range of time on both sides to
	fit the relative triggers that have the largest time periods.
	If a trigger's offset is negative, like the -10 minutes in the
	example above, then we must expand the
	<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>end</I
></SPAN
> of the time range: in the case above,
	the range's ending time of 6:00 must be grown by 10 minutes to
	6:10 so that the last recurrence instance will be that of
	6:05; computing the trigger's offset we will get the 5:55
	trigger, which is what we wanted.  For triggers with positive
	offsets, like if an alarm were to trigger 20 minutes after an
	event's occurrence, we must expand the
	<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>start</I
></SPAN
> of the time range in an analogous
	way, by subtracting the time offset from it.
      </P
><P
>	Again, absolute triggers need no special computation.  We can
	just see if the trigger time is within the requested range of
	time, and if so, we take that trigger occurrence into account
	for the final result.
      </P
><P
>	In addition, alarms may specify a number of repetitions and a
	duration time.  For example, an alarm may be configured to
	repeat 3 extra times after the original occurrence with 5
	minutes between each repetition.  Again, for absolute triggers
	this does not present a problem, as we can just generate the
	repetitions starting from the absolute trigger time.  For
	relative triggers, we expand the range as described above and
	also add the total offset for the repetitions to the start of
	the range, i.e. 15 extra minutes for the case of 3 repetitions
	with 5 minutes between each.  We do not need to modify the end
	of the range because alarm repetitions always have positive
	offsets, so they are equivalent to relative alarm triggers
	with positive offsets.
      </P
></DIV
><DIV
CLASS="NAVFOOTER"
><BR
CLEAR="all"><BR><TABLE
WIDTH="100%"
BORDER="0"
BGCOLOR="#000000"
CELLPADDING="1"
CELLSPACING="0"
><TR
><TD
WIDTH="25%"
BGCOLOR="#C00000"
ALIGN="left"
><A
HREF="calendar-alarm-generation.html"
><FONT
COLOR="#FFFFFF"
SIZE="3"
><B
>&#60;&#60;&#60; Previous Page</B
></FONT
></A
></TD
><TD
WIDTH="25%"
BGCOLOR="#0000C0"
ALIGN="center"
><FONT
COLOR="#FFFFFF"
SIZE="3"
><B
><A
HREF="index.html"
><FONT
COLOR="#FFFFFF"
SIZE="3"
><B
>Home</B
></FONT
></A
></B
></FONT
></TD
><TD
WIDTH="25%"
BGCOLOR="#00C000"
ALIGN="center"
><FONT
COLOR="#FFFFFF"
SIZE="3"
><B
><A
HREF="calendar-alarm-generation.html"
><FONT
COLOR="#FFFFFF"
SIZE="3"
><B
>Up</B
></FONT
></A
></B
></FONT
></TD
><TD
WIDTH="25%"
BGCOLOR="#C00000"
ALIGN="right"
><A
HREF="alarm-trigger-generation-code.html"
><FONT
COLOR="#FFFFFF"
SIZE="3"
><B
>Next Page &#62;&#62;&#62;</B
></FONT
></A
></TD
></TR
><TR
><TD
COLSPAN="2"
ALIGN="left"
><FONT
COLOR="#FFFFFF"
SIZE="3"
><B
>How the Wombat generates alarm instances</B
></FONT
></TD
><TD
COLSPAN="2"
ALIGN="right"
><FONT
COLOR="#FFFFFF"
SIZE="3"
><B
>Alarm trigger generation code</B
></FONT
></TD
></TR
></TABLE
></DIV
></BODY
></HTML
>